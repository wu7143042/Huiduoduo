(function(a){a.fn.scrollLoading=function(k){var f={attr:"data-url",container:a(window),callback:a.noop,onerror:a.noop};var e=a.extend({},f,k||{});e.cache=[];a(this).each(function(){var m=this.nodeName.toLowerCase(),l=a(this).attr(e.attr);var n={obj:a(this),tag:m,url:l};e.cache.push(n)});var i=function(l){if(a.isFunction(e.callback)){e.callback(l)}};var h=function(l){if(a.isFunction(e.onerror)){e.onerror(l)}};var d=function(){var l=e.container.height();if(e.container.get(0)===window){contop=a(window).scrollTop()}else{contop=e.container.offset().top}a.each(e.cache,function(u,t){var p=t.obj,A=t.tag,m=t.url,z,v;var s=__STATIC_SERVER__+"/image/blank.png";if(p){z=p.offset().top-contop,v=z+p.height();if((z>=0&&z<l)||(v>0&&v<=l)){if(m==""){if(A==="img"){p.attr("src",s);p.removeClass("lazy-image");p.addClass("lazy-image-error");i(p);return}else{i(p)}}else{if(A==="img"){p.attr("src",m);p.error(function(){var o=p.attr("src");if(o.toLowerCase()==s.toLowerCase()){return}p.attr("src",s);p.addClass("lazy-image-error");h(p)});p.load(function(){p.removeClass("lazy-image");p.removeAttr("data-url");i(p)})}else{if(typeof(p.attr("data-template"))!="undefined"){if(typeof(p.attr("data-loading"))!="undefined"){return}p.attr("data-loading","true");if(p.children().length>0&&p.children().get(0).tagName.toLowerCase()!="script"){g(p);return}var y=p.data("template");var m=p.data("url");var r=p.data("ajaxtype");var x=p.data("localstorage");var n=p.data("ischanged");var q=p.data("initcall");var w="";if(x!=undefined&&x.length>0&&(x.indexOf("floor-")==-1||x.indexOf("floor-")==0&&n=="0")){w=b(x,3600*0.5)}if(w.length==0){if(r!==undefined&&r=="get"){getAjaxRequest(m,{},function(D){if(D.state==false){g(p);p.addClass("lazy-template-error")}else{var o=a("#"+y).html();var C=Handlebars.compile(o);var B=C(D.data);p.html(B);a(".pageajax").ajax_data({current:D.data.current,size:D.data.size});try{if(!!q){setTimeout(q+"()",1)}}catch(E){console.log(E)}g(p)}i(p)},null,"json")}else{postAjaxRequest(m,{},function(E){if(E.state==false){g(p);p.addClass("lazy-template-error");if(y=="tmp_floor"){p.css("height","0")}p.html("")}else{var B=a("#"+y).html();var D=Handlebars.compile(B);if(E.data!=null&&E.data!=""){var C=D(E.data)}else{var C=D(E.message)}if(x!==undefined&&x.length>0&&"localStorage" in window&&window.localStorage!==null){var o={timestamp:a.now(),content:C};localStorage[x]=JSON.stringify(o)}p.html(C);j(m);g(p)}i(p)})}}else{p.html(w);j(m);g(p)}}else{p.load(m,{},function(){i(p)})}}}t.obj=null}}})};var c=function(){};var g=function(l){l.removeClass("lazy-template");l.removeAttr("data-url");l.removeAttr("data-loading");l.removeAttr("data-initcall");a("img.lazy-image").scrollLoading()};var b=function(m,l){if("localStorage" in window&&window.localStorage!==null){if(localStorage[m]!=null){try{var n=JSON.parse(localStorage[m]);if(n&&n.timestamp&&n.content&&(a.now()-n.timestamp)/1000<l){return n.content}else{}}catch(o){console.warn("JSON.parse",o)}}}return""};var j=function(l){if(l.indexOf("/index/navbar.do")>-1){var m=document.location.pathname;m=m.replace(/(-c[0-9]+-p[0-9]+|-p[0-9]+)?.html/,"");a(".tmp_navbar").each(function(){var n=a(this).attr("href");if(n!=undefined&&typeof(n)=="string"&&n!=""&&n.indexOf(m)>-1){a(this).find("li").addClass("on");return false}})}};d();e.container.bind("scroll",d)}})(jQuery);